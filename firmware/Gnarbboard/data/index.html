<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Gnarboard</title>
    <!-- Icon source: https://icon-icons.com -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
    <link rel="stylesheet" type="text/css" href="bootstrap.min.css">
    <script src="gnarboard.js?v=1.0.0"></script>
    <script src="jquery-3.7.0.min.js"></script> 
    <script src="bootstrap.min.js"></script>
    <script src="jscookie.js"></script>
    <style>
        .form-label {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <script>
        $(document).ready(start_gnarboard);
        let FF_FOUC_FIX;
    </script>
    <div class="col-lg-8 mx-auto">
        <nav class="navbar sticky-top navbar-expand-md bg-body-tertiary navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" onclick="open_page('control')" href="#control">
                    <img src="logo-72.png" alt="Avast ye scurvy dog." width="30" height="30">
                    <span id="boardName">Gnarboard</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li id="controlNav" class="nav-item">
                            <a class="nav-link active" onclick="open_page('control')" aria-current="page" href="#control">Control</a>
                        </li>
                        <li id="configNav" class="nav-item">
                            <a class="nav-link" onclick="open_page('config')" href="#config">Config</a>
                        </li>
                        <li id="statsNav" class="nav-item">
                            <a class="nav-link" onclick="open_page('stats')" href="#stats">Status</a>
                        </li>
                        <li id="networkNav" class="nav-item">
                            <a class="nav-link" onclick="open_page('network')" href="#network">Network</a>
                        </li>
                        <li id="systemNav" class="nav-item">
                            <a class="nav-link" onclick="open_page('system')" href="#system">System</a>
                        </li>
                        <li id="logoutNav" class="nav-item">
                            <a class="nav-link" onclick="open_page('logout')" href="#logout">Logout</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <script>
            $('.navbar-collapse ul li a').click(function(){ 
                $('.navbar-toggler:visible').click();
            });
            $(function () {
                $('.navbar-collapse ul li a:not(.dropdown-toggle)').bind('click touchstart', function () {
                    $('.navbar-toggler:visible').click();
                });
            });
        </script>
        <main>
            <div id="liveAlertPlaceholder"></div>
            <div id="loading" style="display: none">
                <div class="d-flex justify-content-center align-items-center" style="height: 300px">
                    <div class="spinner-border" role="status" style="width: 7rem; height: 7rem;"></div>
                </div>
            </div>
            <div id="controlPage" style="display:none" class="pageContainer row mt-3 mx-2">
                <table id="channelTable" class="table table-hover">
                    <thead>
                        <tr>
                            <th class="text-center" scope="col">State</th>
                            <th scope="col">Name</th>
                            <th class="text-end" scope="col">PWM</th>
                            <th class="text-end" scope="col">Current</th>
                        </tr>
                    </thead>
                    <tbody id="channelTableBody" class="table-group-divider"></tbody>
                </table>
            </div>
            <div id="configPage" style="display:none" class="pageContainer mt-2 mx-2">
                <form class="row g-3" id="channelConfigForm"></form>
            </div>
            <div id="statsPage" style="display:none" class="pageContainer row mt-3 mx-2">
                <div class="col-sm">
                    <h5>Channel Statistics</h5>
                    <table id="channelStatsTable" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th scope="col">Channel</th>
                                <th class="text-end" scope="col">aH</th>
                                <th class="text-end" scope="col">wH</th>
                                <th class="text-end" scope="col">Switches</th>
                                <th class="text-end" scope="col">Trips</th>
                            </tr>
                        </thead>
                        <tbody id="channelStatsTableBody" class="table-group-divider"></tbody>
                    </table>
                </div>
                <div class="col-sm">
                    <h5>Board Statistics</h5>
                    <table id="statsTable" class="table table-striped table-hover">
                        <tbody>
                            <tr>
                                <th scope="row">Bus Voltage:</th>
                                <td id="bus_voltage" class="text-end"></td>
                            </tr>
                            <tr>
                                <th scope="row">Uptime:</th>
                                <td id="uptime" class="text-end"></td>
                            </tr>
                            <tr>
                                <th scope="row">Messages:</th>
                                <td id="messages" class="text-end"></td>
                            </tr>
                            <tr>
                                <th scope="row">Heap Size:</th>
                                <td id="heap_size" class="text-end"></td>
                            </tr>
                            <tr>
                                <th scope="row">Free Heap:</th>
                                <td id="free_heap" class="text-end"></td>
                            </tr>
                            <tr>
                                <th scope="row">Minimum Free Heap:</th>
                                <td id="min_free_heap" class="text-end"></td>
                            </tr>
                            <tr>
                                <th scope="row">Max Alloc Heap:</th>
                                <td id="max_alloc_heap" class="text-end"></td>
                            </tr>
                            <tr>
                                <th scope="row">IP Address:</th>
                                <td id="ip_address" class="text-end"></td>
                            </tr>
                            <tr>
                                <th scope="row">WiFi RSSI:</th>
                                <td id="rssi" class="text-end"></td>
                            </tr>
                            <tr>
                                <th scope="row">UUID:</th>
                                <td id="uuid" class="text-end"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div id="networkPage" style="display:none" class="pageContainer mt-3 mx-2">
                <div class="row">
                    <div class="col-lg-6">
                        <h5>Network Configuration</h5>
                        <div class="mb-3">
                            <label for="wifi_mode" class="col-form-label">Wifi Mode</label>
                            <div>
                                <select id="wifi_mode" class="form-select" aria-label="Wifi Mode">
                                    <option value="ap">AP (You connect to Gnarboard)</option>
                                    <option value="client">Client (Gnarboard connects to WiFi)</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="wifi_ssid" class="col-form-label">Wifi Name (SSID)</label>
                            <div class="">
                                <input id="wifi_ssid" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="wifi_pass" class="col-form-label">Wifi Password</label>
                            <div class="">
                                <input id="wifi_pass" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="local_hostname" class="col-form-label">Local Hostname</label>
                            <div class="input-group">
                                <input id="local_hostname" type="text" class="form-control">
                                <span class="input-group-text">.local</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <h5>App Configuration</h5>
                        <div class="mb-3">
                            <label for="app_user" class="col-form-label">App Username</label>
                            <div class="">
                                <input id="app_user" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="app_pass" class="col-form-label">App Password</label>
                            <div class="">
                                <input id="app_pass" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="" id="require_login" checked>
                                <label class="form-check-label" for="require_login">
                                  Require login with username / password
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mb-3 text-center">
                    <button type="button" class="btn btn-primary" onclick="save_network_settings()">Save Settings</button>
                </div>
            </div>
            <div id="systemPage" style="display:none" class="pageContainer mt-3 mx-2">
                <div class="row">
                    <div class="col-lg-6 mb-3">
                        <h5>Firmware</h5>
                        <div id="firmware_checking" class="alert alert-secondary" role="alert">
                            Checking for new firmware...
                        </div>
                        <div id="firmware_up_to_date" class="alert alert-success" role="alert" style="display: none">
                            Firmware is up to date.
                        </div>
                        <div id="firmware_update_available" style="display: none" class="alert alert-primary mt-3" role="alert">
                            New firmware version: <span></span><br/>
                            <br/>
                            <button type="button" class="btn btn-primary" onclick="update_firmware()">Update Firmware</button><br/>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <h5>Miscellaneous</h5>
                        <button class="btn btn-primary" type="button" onclick="restart_board()">Restart Board</button>
                        <button class="btn btn-danger" type="button" onclick="reset_to_factory()">Reset to Factory Defaults</button>
                    </div>
                </div>
            </div>
        </main>
        <footer class="p-4 text-body-secondary text-center">
            WebSocket:
            <span id="connection_startup" class="connection_status text-primary">CONNECTING</span>
            <span id="connection_good" class="connection_status text-success" style="display: none">CONNECTED</span>
            <span id="connection_retrying" class="connection_status text-warning" style="display: none">RETRYING (<span id="retries_count"></span>s)</span>
            <span id="connection_failed" class="connection_status text-danger" style="display: none">FAILED</span>
            <br/>
            <a id="projectName" href="https://github.com/hoeken/Gnarboard">Gnarboard</a> &copy; 2023<br>
            <a href="https://www.oshwa.org/"><img src="oshw-logo-antipixel.webp"></a>
        </footer>
    </div>
</body>
</html>